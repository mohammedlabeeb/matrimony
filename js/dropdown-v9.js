(function(B){function A(){this._orgOpt={};this._defaults={label:"",autoSelected:true,displayOption:"default",autocomplete:true,showLabelOnClose:false,change:function(){},complete:function(){}}}B.fn.dropdown=function(C){return this.each(function(){if(typeof C=="string"&&C=="update"){B.dropdown._update(this,B.dropdown._orgOpt[this.id])}else{B.dropdown._createDropDown(this,C)}})};B.extend(A.prototype,{_createDropDown:function(Q,N){var D=false;var K=[];var P={};B.extend(P,this._defaults,N);this._orgOpt[Q.id]=P;if(!P.autoSelected){B("#"+Q.id+" option:selected").attr("selected",false)}else{B.each(B("#"+Q.id+" option:selected"),function(U,T){K.push(T.value)})}ddSelWrap=B("<div>",{"class":"ddSelWrap",id:"ddSelWrap_"+Q.id});ddOptHolderWrapper=B("<div>",{"class":"ddOptHolderWrapper",id:"ddOptHolderWrapper_"+Q.id,mouseenter:function(T){D=true},mouseleave:function(T){D=false}});ddOptHolder=B("<div>",{"class":"ddOptHolder",id:"ddOptHolder_"+Q.id,click:function(T){T.stopPropagation();if(B(this).hasClass("ddOptHolderOpen")){F()}else{I()}}});ddLabelHolder=B("<div>",{"class":"ddLabelHolder",id:"ddLabelHolder_"+Q.id,click:function(T){if(B(this).hasClass("ddLabelHolderOpen")){T.stopPropagation()}}});ddLabel=B("<p>",{"class":"ddLabel"});ddSelOptHolder=B("<div>",{"class":"ddSelOptHolder",id:"ddSelOptHolder_"+Q.id,click:function(T){if(P.label!=undefined&&P.label!=""){T.stopPropagation()}B("#ddSelOptText_"+Q.id).focus();if(P.label==""||P.label==undefined){if(B(this).hasClass("ddSelOptHolderOpen")){F()}else{I()}}}});ddSelOptText=B("<input>",{type:"text","class":"ddSelOptText",id:"ddSelOptText_"+Q.id,autocomplete:"off",css:{display:"none"},click:function(T){T.stopPropagation()},keydown:function(T){L(B(this),T)},keypress:function(T){L(B(this),T)},keyup:function(T){L(B(this),T)},blur:function(T){if(!D){F()}}});ddOptionHolder=B("<div>",{"class":"ddOptionHolder",id:"ddOptionHolder_"+Q.id});if(P.label!=""&&P.label!=undefined){ddLabel.text(P.label);ddLabel.appendTo(ddLabelHolder);ddLabelHolder.appendTo(ddOptHolder)}if(P.autoSelected){B.each(K,function(T,U){ddSelectedOptSpan=M(B('select[name="'+Q.name+'"] option[value="'+unescape(U)+'"]'));ddSelectedOptSpan.appendTo(ddSelOptHolder)});if(K.length==0){ddSelectedOptSpan=B("<span>",{"class":"ddSelectedOptSpan",id:"ddSelectedOptSpan_"+Q.id+"_"+B("#"+Q.id+" option:first").val(),click:function(T){T.stopPropagation();H(B(this))}});ddSelectedOptSpan.text(B("#"+Q.id+" option:first").text());ddSelectedOptSpan.appendTo(ddSelOptHolder);B('select[name="'+Q.name+'"] option:first').attr("selected","selected")}if(P.displayOption=="comma"){selectedOptSpan=ddSelOptHolder.find("span");selOptStr="";if(selectedOptSpan.length>0){var G=[];B.each(selectedOptSpan,function(T,U){G.push(B(U).text())});selOptStr=G.join(" , ");selOptStr=(selOptStr.length>28)?selOptStr.substr(0,28)+"...":selOptStr}if(P.showLabelOnClose){optWithLabelSpan=B("<span>",{"class":"ddSelectedVal"});optWithLabelSpan.text(selOptStr);optWithLabelSpan.appendTo(ddLabelHolder)}else{ddLabel.text(selOptStr);ddLabel.appendTo(ddLabelHolder)}}else{ddSelOptHolder.addClass("ddSelOptHolderOpen")}}if(P.autocomplete){ddSelOptText.attr("size","1");ddSelOptText.appendTo(ddSelOptHolder)}else{if(ddSelOptHolder.html()==""){ddSelOptHolder.html("&nbsp;");ddSelOptHolder.css("padding-bottom","7px")}}ddSelOptHolder.appendTo(ddOptHolder);ddOptHolder.appendTo(ddOptHolderWrapper);ddOptionHolder.appendTo(ddOptHolderWrapper);ddOptHolderWrapper.appendTo(ddSelWrap);ddSelWrap.insertAfter("#"+Q.id);B("#"+Q.id).hide();function L(T,U){switch(U.keyCode){case 8:if(U.type=="keyup"){if(B("#ddSelOptText_"+Q.id).val().length==0){prevElement=B("#ddSelOptText_"+Q.id).prev();if(prevElement.is("span")){if(prevElement.hasClass("ddSelectedOptSpanHover")){H(prevElement)}else{prevElement.addClass("ddSelectedOptSpanHover")}}}}S();textObjVal=(T==undefined)?"":T.val().toLowerCase();O(textObjVal);break;case 13:U.preventDefault();if(U.type=="keyup"){E(B("#ddOptHolderWrapper_"+Q.id+" .ddOptionHolderLiHover"))}break;case 38:if(U.type=="keydown"){selected=B("#ddOptHolderWrapper_"+Q.id+" .ddOptionHolderLiHover");if(selected.siblings().length>0){B("#ddOptionHolder_"+Q.id+" li").removeClass("ddOptionHolderLiHover");prevSibling=selected.prevAll(":not(.ddOptgroupLI)").first();if(prevSibling.length>0){prevSibling.addClass("ddOptionHolderLiHover")}else{selected.nextAll(":not(.ddOptgroupLI)").last().addClass("ddOptionHolderLiHover")}R()}}break;case 40:if(U.type=="keydown"){selected=B("#ddOptHolderWrapper_"+Q.id+" .ddOptionHolderLiHover");if(selected.siblings().length>0){B("#ddOptionHolder_"+Q.id+" li").removeClass("ddOptionHolderLiHover");nextSibling=selected.nextAll(":not(.ddOptgroupLI)").first();if(nextSibling.length>0){nextSibling.addClass("ddOptionHolderLiHover")}else{selected.prevAll(":not(.ddOptgroupLI)").last().addClass("ddOptionHolderLiHover")}R()}}break;default:S();B("#ddSelOptText_"+Q.id).prev().removeClass("ddSelectedOptSpanHover");if(U.type=="keyup"){textObjVal=(T==undefined)?"":T.val().toLowerCase();O(textObjVal)}break}}function R(){selectedLi=B("#ddOptHolderWrapper_"+Q.id+" .ddOptionHolderLiHover").get(0);wrapperUL=B("#ddOptHolderWrapper_"+Q.id+" .ddOptionHolder ul").get(0);if(selectedLi.offsetTop+selectedLi.offsetHeight>wrapperUL.scrollTop+wrapperUL.clientHeight){wrapperUL.scrollTop=selectedLi.offsetTop+selectedLi.offsetHeight-wrapperUL.clientHeight}else{if(selectedLi.offsetTop<wrapperUL.scrollTop){wrapperUL.scrollTop=selectedLi.offsetTop}}}function S(){var T=(B("#ddSelOptText_"+Q.id).val().length!=0)?B("#ddSelOptText_"+Q.id).val().length:1;B("#ddSelOptText_"+Q.id).attr({width:"auto",size:T})}function I(){J();O();B("#ddOptionHolder_"+Q.id+" li:first").addClass("ddOptionHolderLiHover");B("#ddSelWrap_"+Q.id).addClass("ddSelWrapOpen");B("#ddOptHolder_"+Q.id).addClass("ddOptHolderOpen");B("#ddLabelHolder_"+Q.id).addClass("ddLabelHolderOpen");B("#ddOptionHolder_"+Q.id).addClass("ddOptionHolderOpen");if(P.label!=""&&P.label!=undefined){B("#ddSelOptHolder_"+Q.id).addClass("ddSelOptHolderOpen")}B("#ddSelOptText_"+Q.id).show();B("#ddSelOptText_"+Q.id).val("");B("#ddSelOptText_"+Q.id).focus();if(P.label!=""&&P.label!=undefined){if(P.showLabelOnClose){B("#ddLabelHolder_"+Q.id+" span").remove()}else{B("#ddLabelHolder_"+Q.id+" p").remove();ddLabel.text(P.label);ddLabel.appendTo(B("#ddLabelHolder_"+Q.id))}}else{B("#ddSelOptHolder_"+Q.id+" p.ddSelectedVal").remove();B("#ddSelOptHolder_"+Q.id).children().show()}}function F(T){T=(T==undefined||T=="")?Q.id:T;B("#ddSelWrap_"+T).removeClass("ddSelWrapOpen");B("#ddOptHolder_"+T).removeClass("ddOptHolderOpen");B("#ddLabelHolder_"+T).removeClass("ddLabelHolderOpen");B("#ddOptionHolder_"+T).removeClass("ddOptionHolderOpen");if(P.label!=""&&P.label!=undefined){B("#ddSelOptHolder_"+T).removeClass("ddSelOptHolderOpen")}B("#ddSelOptText_"+Q.id).hide();var V="";if(P.displayOption=="comma"){if(B("#ddSelOptHolder_"+T+" > span").length>0){var U=[];B.each(B("#ddSelOptHolder_"+T+" > span"),function(W,X){U.push(B(X).text())});V=U.join(" , ");V=(V.length>28)?V.substr(0,28)+"...":V}else{optWithBlankVal=B("#"+Q.id+' option[value=""]').text();B("#"+Q.id+' option[value=""]').attr("selected","selected");V=(optWithBlankVal.length>28)?optWithBlankVal.substr(0,28)+"...":optWithBlankVal}if(P.showLabelOnClose){optWithLabelSpan=B("<span>",{"class":"ddSelectedVal"});optWithLabelSpan.text(V);B("#ddLabelHolder_"+T).find("span").remove();B("#ddLabelHolder_"+T).append(optWithLabelSpan)}else{ddLabel.text(V);ddLabel.appendTo(B("#ddLabelHolder_"+T))}}else{if(B("#ddSelOptHolder_"+T).find("span").length==0){optWithBlankVal=B("#"+Q.id).find('option[value=""]');optWithBlankVal.attr("selected","selected");spanArr=M(optWithBlankVal);if(spanArr.length>0){if(P.autocomplete){spanArr.insertBefore("#ddSelOptText_"+Q.id)}else{spanArr.appendTo(B("#ddSelOptHolder_"+Q.id))}}}}}function J(){allDivs=B(".ddOptHolderWrapper");if(allDivs.length>0){B.each(allDivs,function(T,U){if(U.id){divId=U.id.split("_");if(divId[1]!=Q.id){if(B("#"+U.id+" div#ddOptHolder_"+divId[1]).hasClass("ddOptHolderOpen")){F(divId[1])}}}})}}function O(T){T=(T==undefined)?"":T;B("#ddOptionHolder_"+Q.id).html("");ddOptionUL=B("<ul>");selectOptPresent=false;B("#"+Q.id).children().each(function(){if(B(this).is("optgroup")){option=B(this).find("option");optionArr=C(T,option,"ddOptLI");if(optionArr.length>0){ddOptionLI=B("<li>",{"class":"ddOptgroupLI"});ddOptionLI.text(B(this).attr("label"));ddOptionLI.appendTo(ddOptionUL);B.each(optionArr,function(U,V){V.appendTo(ddOptionUL)});selectOptPresent=true}}else{if(B(this).is("option")){optionArr=C(T,B(this));if(optionArr.length>0){B.each(optionArr,function(U,V){V.appendTo(ddOptionUL)});selectOptPresent=true}}}});if(!selectOptPresent){ddOptionLI=B("<li>");ddOptionLI.text("No Record Found"+((T!="")?" For "+T:""));ddOptionLI.appendTo(ddOptionUL)}ddOptionUL.appendTo(B("#ddOptionHolder_"+Q.id));B("#ddOptionHolder_"+Q.id+" li:first").addClass("ddOptionHolderLiHover");B("#ddOptionHolder_"+Q.id+" ul").bind("scroll",function(){B("#ddSelOptText_"+Q.id).focus()})}function C(W,U,V){V=(V==undefined)?"":V;W=(W==undefined)?"":W;var T="";if(W!=""){W=W.replace(/[^a-zA-Z 0-9]+/g,"");T=new RegExp("^("+W+")")}else{T=new RegExp("[0-9A-Za-z]")}optArr=[];U.each(function(){if(!B(this).is(":selected")){if(B(this).text().toLowerCase().match(T)!=null){ddOptionLI=B("<li>",{"class":V,rel:escape(B(this).val()),click:function(X){X.stopPropagation();E(B(this))},mouseover:function(X){B("#ddOptionHolder_"+Q.id+" li").removeClass("ddOptionHolderLiHover");B(this).addClass("ddOptionHolderLiHover")}});ddOptionLI.text(B(this).text());optArr.push(ddOptionLI)}}});return optArr}function E(W){selectedOptId=W.attr("rel");K.push(selectedOptId);B('select[name="'+Q.name+'"] option[value="'+unescape(selectedOptId)+'"]').attr("selected","selected");P.change.call(this,selectedOptId);var U=[];B.each(B('select[name="'+Q.name+'"] option:selected'),function(Y,X){U.push(X.value)});var V=[];B.each(K,function(X,Y){if(B.inArray(unescape(Y),U)!=-1){V.push(unescape(Y))}});K=V;B("#ddSelOptHolder_"+Q.id).find("span").remove();B.each(K,function(X,Y){ddSelectedOptSpan=M(B('select[name="'+Q.name+'"] option[value="'+unescape(Y)+'"]'));if(P.autocomplete){ddSelectedOptSpan.insertBefore("#ddSelOptText_"+Q.id)}else{ddSelectedOptSpan.appendTo(B("#ddSelOptHolder_"+Q.id))}});var T=B("#ddOptionHolder_"+Q.id+" ul").scrollTop();B("#ddSelOptText_"+Q.id).val("");O();B("#ddSelOptText_"+Q.id).focus();B("#ddOptionHolder_"+Q.id+" ul").scrollTop(T);P.complete.call(this)}function M(T){ddSelectedOptSpan=B("<span>",{"class":"ddSelectedOptSpan",rel:T.val(),click:function(U){U.stopPropagation();H(B(this))}});ddSelectedOptSpan.text(T.text());return ddSelectedOptSpan}function H(U){selectedOptId=U.attr("rel");var T=B.inArray(selectedOptId,K);K.splice(T,1);B('select[name="'+Q.name+'"] option[value="'+unescape(selectedOptId)+'"]').attr("selected",false);B("#ddSelOptText_"+Q.id).focus();P.change.call();U.remove();if(P.label==""||P.label==undefined){I()}else{O()}if(B("#ddSelOptHolder_"+Q.id).html()==""){B("#ddSelOptHolder_"+Q.id).html("&nbsp;");B("#ddSelOptHolder_"+Q.id).css("padding-bottom","7px")}P.complete.call(this)}},_update:function(D,C){B("#"+D.id).nextAll().remove();this._createDropDown(D,C)}});B.dropdown=new A()})(jQuery);